
R version 3.3.0 (2016-05-03) -- "Supposedly Educational"
Copyright (C) 2016 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(nlme)
> is64bit <- .Machine$sizeof.pointer == 8
> 
> options(digits = 10)# <- see more, as we have *no* *.Rout.save file here
> ## https://stat.ethz.ch/pipermail/r-help/2014-September/422123.html
> nfm <- nlme(circumference ~ SSlogis(age, Asym, xmid, scal),
+             data = Orange,
+             fixed = Asym + xmid + scal ~ 1)
> (sO <- summary(nfm))
Nonlinear mixed-effects model fit by maximum likelihood
  Model: circumference ~ SSlogis(age, Asym, xmid, scal) 
 Data: Orange 
          AIC         BIC       logLik
  279.9812952 295.5347758 -129.9906476

Random effects:
 Formula: list(Asym ~ 1, xmid ~ 1, scal ~ 1)
 Level: Tree
 Structure: General positive-definite, Log-Cholesky parametrization
         StdDev       Corr         
Asym     27.051312296 Asym   xmid  
xmid     24.258159091 -0.327       
scal     36.597077739 -0.992  0.443
Residual  7.321524864              

Fixed effects: list(Asym ~ 1, xmid ~ 1, scal ~ 1) 
           Value   Std.Error DF     t-value p-value
Asym 192.0968649 14.05267138 28 13.66977564       0
xmid 727.5950539 34.58794721 28 21.03608663       0
scal 356.6065982 30.49759258 28 11.69294256       0
 Correlation: 
     Asym   xmid  
xmid  0.277       
scal -0.193  0.665

Standardized Within-Group Residuals:
          Min            Q1           Med            Q3           Max 
-1.8186831117 -0.5214612769  0.1742474693  0.5176166804  1.6452796292 

Number of Observations: 35
Number of Groups: 5 
> vc <- VarCorr(nfm, rdig = 5)# def. 3
> storage.mode(vc) <- "double" # -> (correct) NA warning
Warning message:
In storage.mode(vc) <- "double" : NAs introduced by coercion
> cfO <- sO$tTable
> if(FALSE)
+     dput(signif(cfO[,c("Std.Error", "t-value")], 8))
> cfO.T <- array(
+     if(is64bit)## R-devel 2016-01-11; [lynne]:
+         c(14.052671, 34.587947, 30.497593,
+           13.669776, 21.036087, 11.692943)
+     else ## R-devel 2016-01-11; [f32sfs-2]:
+         c(14.053663, 34.589821, 30.49412,
+           13.668653, 21.034544, 11.693889)
+    , dim = 3:2, dimnames = list(c("Asym", "xmid", "scal"),
+ 				c("Std.Error", "t-value")))
> if(FALSE)
+     dput(signif(as.vector(vc[,"StdDev"]), 8))
> vcSD <- setNames(if(is64bit)## R-devel 2016-01-11; [lynne]:
+ 		     c(27.051312, 24.258159, 36.597078, 7.321525)
+ 		 else ## R-devel 2016-01-11; [f32sfs-2]:
+ 		     c(27.053964, 24.275286, 36.58682, 7.321365),
+ 		 c("Asym", "xmid", "scal", "Residual"))
> stopifnot(
+     identical(cfO[,"Value"], fixef(nfm)),
+     all.equal(cfO[,c("Std.Error", "t-value")], cfO.T, tol = 2e-4)# 8.7e-5 (R 3.0.3, 32b)
+    ,
+     cfO[,"DF"] == 28,
+     all.equal(vc[,"Variance"], vc[,"StdDev"]^2, tol= 5e-7)
+    ,
+     all.equal(vc[,"StdDev"], vcSD, tol = 6e-4) # 3.5e-4 (R 3.0.3, 32b)
+    ,
+     all.equal(unname(vc[2:3, 3:4]), # "Corr"
+               rbind(c(-0.3273, NA),
+ 		    c(-0.9920, 0.4430)), tol = 2e-3)# ~ 2e-4 / 8e-4
+ )
> 
> ## Confirm  predict(*, newdata=.)  works
> (n <- nrow(Orange)) # 35
[1] 35
> set.seed(17)
> newOr <- within(Orange[sample(n, 64, replace=TRUE), ],
+ 		age <- round(jitter(age, amount = 50)))
> fit.v <- predict(nfm, newdata = newOr)
> resiv <- newOr$circumference - fit.v
> res.T <- c(48, 115, 74, 15, 44, -94, 47, -51, 20, -52, -16, 12, -135,
+            -85, 136, 100, 24, 181, -88, -102, -26, 52, -148, 8, -83, 73,
+            -27, -34, 91, 42, 34, -8, 0, 83, 84, -90, -123, 94, -157, -11,
+            56, -164, -28, 72, 15, 148, 95, -122, 169, 84, -19, -124, 45,
+            -66, -10, 119, -110, -43, 12, 94, -108, 45, 48, 46)
> if(!all((res10 <- round(10 * as.vector(resiv))) == res.T)) {
+     iD <- which(res10 != res.T)
+     cat("Differing rounded residuals, at indices", paste(iD, collapse=", "),
+         "; with values:\n")
+     print(cbind(resiv, res10, res.T)[iD,])
+ }
Differing rounded residuals, at indices 14 ; with values:
        resiv         res10         res.T 
 -8.550212042 -86.000000000 -85.000000000 
> ## -> indices  14 [64-bit]  or  27 [32-bit], respectively
> 
> 
> ## [Bug 16715] New: nlme: unable to use predict and augPredict ..
> ## Date: 17 Feb 2016 -- part 2 -- predict():
> ##
> ## Comment 4 daveauty@gmail.com 2016-03-08 -- modified by MM --
> 
> ## simulate density data then fit Michaelis-Menten equation of density as
> ## function of ring age. TreeIDs grouped by SP (spacing)
> set.seed(1)
> df <- data.frame(SP = rep(LETTERS[1:5], 60),
+ 		 expand.grid(TreeID = factor(1:12), age = seq(2, 50, 2)))
> df[,"dens"] <- with(df, (runif(1,10,20)*age)/(runif(1,9,10)+age)) + rnorm(25, 0, 1)
> str(df)
'data.frame':	300 obs. of  4 variables:
 $ SP    : Factor w/ 5 levels "A","B","C","D",..: 1 2 3 4 5 1 2 3 4 5 ...
 $ TreeID: Factor w/ 12 levels "1","2","3","4",..: 1 2 3 4 5 6 7 8 9 10 ...
 $ age   : num  2 2 2 2 2 2 2 2 2 2 ...
 $ dens  : num  2.41 1.39 3.82 2.56 1.41 ...
> ## 'data.frame':	300 obs. of  4 variables:
> ##  $ SP    : Factor w/ 5 levels "A","B","C","D",..: 1 2 3 4 5 1 2 3 4 5 ...
> ##  $ TreeID: Factor w/ 12 levels "1","2","3","4",..: 1 2 3 4 5 6 7 8 9 10 ...
> ##  $ age   : num  2 2 2 2 2 2 2 2 2 2 ...
> ##  $ dens  : num  2.41 1.39 3.82 2.56 1.41 ...
> 
> ## mixed-effects model
> fit1 <- nlme(dens ~ a*age/(b+age),
+ 	     fixed = a+b ~ 1, random= a ~ 1|TreeID,
+ 	     start = c(a=15, b=5), data=df)
> summary(fit1)
Nonlinear mixed-effects model fit by maximum likelihood
  Model: dens ~ a * age/(b + age) 
 Data: df 
          AIC         BIC       logLik
  808.4069212 823.2220511 -400.2034606

Random effects:
 Formula: a ~ 1 | TreeID
                      a     Residual
StdDev: 2.772067654e-05 0.9185793399

Fixed effects: a + b ~ 1 
         Value    Std.Error  DF     t-value p-value
a 12.758125778 0.1914871858 287 66.62652502       0
b  8.921206208 0.4906380742 287 18.18286570       0
 Correlation: 
  a    
b 0.918

Standardized Within-Group Residuals:
          Min            Q1           Med            Q3           Max 
-2.6420672775 -0.2833115761  0.2220191315  0.6630992082  1.6161028824 

Number of Observations: 300
Number of Groups: 12 
> ## allow fixed effects parameters to vary by 'SP':
> fit2 <- update(fit1, fixed = list(a ~ SP, b ~ SP),
+                start = c(a = rep(14, 5), b = rep(4, 5)))
> summary(fit2)
Nonlinear mixed-effects model fit by maximum likelihood
  Model: dens ~ a * age/(b + age) 
 Data: df 
         AIC         BIC      logLik
  799.210016 843.6554057 -387.605008

Random effects:
 Formula: a ~ 1 | TreeID
          a.(Intercept)     Residual
StdDev: 2.877033198e-05 0.8808025132

Fixed effects: list(a ~ SP, b ~ SP) 
                     Value    Std.Error  DF      t-value p-value
a.(Intercept) 12.903085407 0.4091007676 279 31.540115368  0.0000
a.SPB         -0.170084473 0.5947105293 279 -0.285995396  0.7751
a.SPC         -0.643219788 0.5919816319 279 -1.086553624  0.2782
a.SPD          0.095662357 0.5731020393 279  0.166920287  0.8676
a.SPE         -0.008338959 0.5812270667 279 -0.014347162  0.9886
b.(Intercept)  8.646804007 1.0165457496 279  8.506064789  0.0000
b.SPB          0.686459399 1.5205832769 279  0.451444791  0.6520
b.SPC          0.672297818 1.5446580595 279  0.435240547  0.6637
b.SPD         -0.159835887 1.4178921302 279 -0.112727819  0.9103
b.SPE          0.221183964 1.4603631261 279  0.151458195  0.8797
 Correlation: 
              a.(In) a.SPB  a.SPC  a.SPD  a.SPE  b.(In) b.SPB  b.SPC  b.SPD 
a.SPB         -0.688                                                        
a.SPC         -0.691  0.475                                                 
a.SPD         -0.714  0.491  0.493                                          
a.SPE         -0.704  0.484  0.486  0.502                                   
b.(Intercept)  0.916 -0.630 -0.633 -0.654 -0.645                            
b.SPB         -0.612  0.919  0.423  0.437  0.431 -0.669                     
b.SPC         -0.603  0.415  0.918  0.430  0.424 -0.658  0.440              
b.SPD         -0.657  0.452  0.454  0.915  0.462 -0.717  0.479  0.472       
b.SPE         -0.637  0.438  0.441  0.455  0.917 -0.696  0.465  0.458  0.499

Standardized Within-Group Residuals:
           Min             Q1            Med             Q3            Max 
-2.39676502924 -0.45686320605  0.04081417726  0.74467663616  2.17580169507 

Number of Observations: 300
Number of Groups: 12 
> 
> ## make new data for predictions
> newdat <- expand.grid(SP = LETTERS[1:5], age = seq(1, 50, 1))
> n.pred1 <- predict(fit1, newdat, level=0) # works fine
> n.pred2 <- predict(fit2, newdat, level=0)
> ## in nlme 3.1-124, throws the error:
> ## Error in eval(expr, envir, enclos) : object 'SP' not found
> 
> ## New data with  never-yet observed levels of a random effect -- PR#16614 :
> set.seed(47)
> newD <- expand.grid(SP = LETTERS[2:4], age = runif(16, 1,50),
+                     TreeID = sample(c(sample(1:12, 7), 100:102)))
> n1prD0 <- predict(fit1, newD, level=0)
> n2prD0 <- predict(fit2, newD, level=0)
> n1prD1 <- predict(fit1, newD, level=1)   # failed in nlme <= 3.1-126
> n2prD1 <- predict(fit2, newD, level=1)   # ditto
> (n1prD01 <- predict(fit1, newD, level=0:1))#  "
    TreeID predict.fixed predict.TreeID
1        1  10.788697603   10.788697604
2        1  10.788697603   10.788697604
3        1  10.788697603   10.788697604
4        1   8.728189214    8.728189215
5        1   8.728189214    8.728189215
6        1   8.728189214    8.728189215
7        1  10.348507081   10.348507082
8        1  10.348507081   10.348507082
9        1  10.348507081   10.348507082
10       1  10.491889153   10.491889154
11       1  10.491889153   10.491889154
12       1  10.491889153   10.491889154
13       1   9.764878647    9.764878648
14       1   9.764878647    9.764878648
15       1   9.764878647    9.764878648
16       1  10.159568881   10.159568882
17       1  10.159568881   10.159568882
18       1  10.159568881   10.159568882
19       1   8.831372619    8.831372620
20       1   8.831372619    8.831372620
21       1   8.831372619    8.831372620
22       1   9.298569650    9.298569651
23       1   9.298569650    9.298569651
24       1   9.298569650    9.298569651
25       1   9.643529914    9.643529915
26       1   9.643529914    9.643529915
27       1   9.643529914    9.643529915
28       1  10.697735078   10.697735079
29       1  10.697735078   10.697735079
30       1  10.697735078   10.697735079
31       1   5.951768076    5.951768077
32       1   5.951768076    5.951768077
33       1   5.951768076    5.951768077
34       1  10.189950686   10.189950687
35       1  10.189950686   10.189950687
36       1  10.189950686   10.189950687
37       1   6.388445583    6.388445583
38       1   6.388445583    6.388445583
39       1   6.388445583    6.388445583
40       1   9.861056861    9.861056862
41       1   9.861056861    9.861056862
42       1   9.861056861    9.861056862
43       1   9.479675711    9.479675712
44       1   9.479675711    9.479675712
45       1   9.479675711    9.479675712
46       1  10.654979640   10.654979641
47       1  10.654979640   10.654979641
48       1  10.654979640   10.654979641
193      7  10.788697603   10.788697602
194      7  10.788697603   10.788697602
195      7  10.788697603   10.788697602
196      7   8.728189214    8.728189214
197      7   8.728189214    8.728189214
198      7   8.728189214    8.728189214
199      7  10.348507081   10.348507081
200      7  10.348507081   10.348507081
201      7  10.348507081   10.348507081
202      7  10.491889153   10.491889152
203      7  10.491889153   10.491889152
204      7  10.491889153   10.491889152
205      7   9.764878647    9.764878646
206      7   9.764878647    9.764878646
207      7   9.764878647    9.764878646
208      7  10.159568881   10.159568881
209      7  10.159568881   10.159568881
210      7  10.159568881   10.159568881
211      7   8.831372619    8.831372619
212      7   8.831372619    8.831372619
213      7   8.831372619    8.831372619
214      7   9.298569650    9.298569649
215      7   9.298569650    9.298569649
216      7   9.298569650    9.298569649
217      7   9.643529914    9.643529914
218      7   9.643529914    9.643529914
219      7   9.643529914    9.643529914
220      7  10.697735078   10.697735078
221      7  10.697735078   10.697735078
222      7  10.697735078   10.697735078
223      7   5.951768076    5.951768076
224      7   5.951768076    5.951768076
225      7   5.951768076    5.951768076
226      7  10.189950686   10.189950686
227      7  10.189950686   10.189950686
228      7  10.189950686   10.189950686
229      7   6.388445583    6.388445582
230      7   6.388445583    6.388445582
231      7   6.388445583    6.388445582
232      7   9.861056861    9.861056860
233      7   9.861056861    9.861056860
234      7   9.861056861    9.861056860
235      7   9.479675711    9.479675711
236      7   9.479675711    9.479675711
237      7   9.479675711    9.479675711
238      7  10.654979640   10.654979639
239      7  10.654979640   10.654979639
240      7  10.654979640   10.654979639
289     12  10.788697603   10.788697603
290     12  10.788697603   10.788697603
291     12  10.788697603   10.788697603
292     12   8.728189214    8.728189214
293     12   8.728189214    8.728189214
294     12   8.728189214    8.728189214
295     12  10.348507081   10.348507081
296     12  10.348507081   10.348507081
297     12  10.348507081   10.348507081
298     12  10.491889153   10.491889153
299     12  10.491889153   10.491889153
300     12  10.491889153   10.491889153
301     12   9.764878647    9.764878647
302     12   9.764878647    9.764878647
303     12   9.764878647    9.764878647
304     12  10.159568881   10.159568881
305     12  10.159568881   10.159568881
306     12  10.159568881   10.159568881
307     12   8.831372619    8.831372619
308     12   8.831372619    8.831372619
309     12   8.831372619    8.831372619
310     12   9.298569650    9.298569650
311     12   9.298569650    9.298569650
312     12   9.298569650    9.298569650
313     12   9.643529914    9.643529915
314     12   9.643529914    9.643529915
315     12   9.643529914    9.643529915
316     12  10.697735078   10.697735078
317     12  10.697735078   10.697735078
318     12  10.697735078   10.697735078
319     12   5.951768076    5.951768076
320     12   5.951768076    5.951768076
321     12   5.951768076    5.951768076
322     12  10.189950686   10.189950686
323     12  10.189950686   10.189950686
324     12  10.189950686   10.189950686
325     12   6.388445583    6.388445583
326     12   6.388445583    6.388445583
327     12   6.388445583    6.388445583
328     12   9.861056861    9.861056861
329     12   9.861056861    9.861056861
330     12   9.861056861    9.861056861
331     12   9.479675711    9.479675711
332     12   9.479675711    9.479675711
333     12   9.479675711    9.479675711
334     12  10.654979640   10.654979640
335     12  10.654979640   10.654979640
336     12  10.654979640   10.654979640
145      5  10.788697603   10.788697603
146      5  10.788697603   10.788697603
147      5  10.788697603   10.788697603
148      5   8.728189214    8.728189215
149      5   8.728189214    8.728189215
150      5   8.728189214    8.728189215
151      5  10.348507081   10.348507081
152      5  10.348507081   10.348507081
153      5  10.348507081   10.348507081
154      5  10.491889153   10.491889153
155      5  10.491889153   10.491889153
156      5  10.491889153   10.491889153
157      5   9.764878647    9.764878647
158      5   9.764878647    9.764878647
159      5   9.764878647    9.764878647
160      5  10.159568881   10.159568881
161      5  10.159568881   10.159568881
162      5  10.159568881   10.159568881
163      5   8.831372619    8.831372619
164      5   8.831372619    8.831372619
165      5   8.831372619    8.831372619
166      5   9.298569650    9.298569650
167      5   9.298569650    9.298569650
168      5   9.298569650    9.298569650
169      5   9.643529914    9.643529915
170      5   9.643529914    9.643529915
171      5   9.643529914    9.643529915
172      5  10.697735078   10.697735078
173      5  10.697735078   10.697735078
174      5  10.697735078   10.697735078
175      5   5.951768076    5.951768076
176      5   5.951768076    5.951768076
177      5   5.951768076    5.951768076
178      5  10.189950686   10.189950686
179      5  10.189950686   10.189950686
180      5  10.189950686   10.189950686
181      5   6.388445583    6.388445583
182      5   6.388445583    6.388445583
183      5   6.388445583    6.388445583
184      5   9.861056861    9.861056861
185      5   9.861056861    9.861056861
186      5   9.861056861    9.861056861
187      5   9.479675711    9.479675712
188      5   9.479675711    9.479675712
189      5   9.479675711    9.479675712
190      5  10.654979640   10.654979640
191      5  10.654979640   10.654979640
192      5  10.654979640   10.654979640
385    101  10.788697603             NA
386    101  10.788697603             NA
387    101  10.788697603             NA
388    101   8.728189214             NA
389    101   8.728189214             NA
390    101   8.728189214             NA
391    101  10.348507081             NA
392    101  10.348507081             NA
393    101  10.348507081             NA
394    101  10.491889153             NA
395    101  10.491889153             NA
396    101  10.491889153             NA
397    101   9.764878647             NA
398    101   9.764878647             NA
399    101   9.764878647             NA
400    101  10.159568881             NA
401    101  10.159568881             NA
402    101  10.159568881             NA
403    101   8.831372619             NA
404    101   8.831372619             NA
405    101   8.831372619             NA
406    101   9.298569650             NA
407    101   9.298569650             NA
408    101   9.298569650             NA
409    101   9.643529914             NA
410    101   9.643529914             NA
411    101   9.643529914             NA
412    101  10.697735078             NA
413    101  10.697735078             NA
414    101  10.697735078             NA
415    101   5.951768076             NA
416    101   5.951768076             NA
417    101   5.951768076             NA
418    101  10.189950686             NA
419    101  10.189950686             NA
420    101  10.189950686             NA
421    101   6.388445583             NA
422    101   6.388445583             NA
423    101   6.388445583             NA
424    101   9.861056861             NA
425    101   9.861056861             NA
426    101   9.861056861             NA
427    101   9.479675711             NA
428    101   9.479675711             NA
429    101   9.479675711             NA
430    101  10.654979640             NA
431    101  10.654979640             NA
432    101  10.654979640             NA
241     11  10.788697603   10.788697603
242     11  10.788697603   10.788697603
243     11  10.788697603   10.788697603
244     11   8.728189214    8.728189214
245     11   8.728189214    8.728189214
246     11   8.728189214    8.728189214
247     11  10.348507081   10.348507081
248     11  10.348507081   10.348507081
249     11  10.348507081   10.348507081
250     11  10.491889153   10.491889153
251     11  10.491889153   10.491889153
252     11  10.491889153   10.491889153
253     11   9.764878647    9.764878647
254     11   9.764878647    9.764878647
255     11   9.764878647    9.764878647
256     11  10.159568881   10.159568881
257     11  10.159568881   10.159568881
258     11  10.159568881   10.159568881
259     11   8.831372619    8.831372619
260     11   8.831372619    8.831372619
261     11   8.831372619    8.831372619
262     11   9.298569650    9.298569650
263     11   9.298569650    9.298569650
264     11   9.298569650    9.298569650
265     11   9.643529914    9.643529914
266     11   9.643529914    9.643529914
267     11   9.643529914    9.643529914
268     11  10.697735078   10.697735078
269     11  10.697735078   10.697735078
270     11  10.697735078   10.697735078
271     11   5.951768076    5.951768076
272     11   5.951768076    5.951768076
273     11   5.951768076    5.951768076
274     11  10.189950686   10.189950686
275     11  10.189950686   10.189950686
276     11  10.189950686   10.189950686
277     11   6.388445583    6.388445583
278     11   6.388445583    6.388445583
279     11   6.388445583    6.388445583
280     11   9.861056861    9.861056861
281     11   9.861056861    9.861056861
282     11   9.861056861    9.861056861
283     11   9.479675711    9.479675711
284     11   9.479675711    9.479675711
285     11   9.479675711    9.479675711
286     11  10.654979640   10.654979640
287     11  10.654979640   10.654979640
288     11  10.654979640   10.654979640
337    100  10.788697603             NA
338    100  10.788697603             NA
339    100  10.788697603             NA
340    100   8.728189214             NA
341    100   8.728189214             NA
342    100   8.728189214             NA
343    100  10.348507081             NA
344    100  10.348507081             NA
345    100  10.348507081             NA
346    100  10.491889153             NA
347    100  10.491889153             NA
348    100  10.491889153             NA
349    100   9.764878647             NA
350    100   9.764878647             NA
351    100   9.764878647             NA
352    100  10.159568881             NA
353    100  10.159568881             NA
354    100  10.159568881             NA
355    100   8.831372619             NA
356    100   8.831372619             NA
357    100   8.831372619             NA
358    100   9.298569650             NA
359    100   9.298569650             NA
360    100   9.298569650             NA
361    100   9.643529914             NA
362    100   9.643529914             NA
363    100   9.643529914             NA
364    100  10.697735078             NA
365    100  10.697735078             NA
366    100  10.697735078             NA
367    100   5.951768076             NA
368    100   5.951768076             NA
369    100   5.951768076             NA
370    100  10.189950686             NA
371    100  10.189950686             NA
372    100  10.189950686             NA
373    100   6.388445583             NA
374    100   6.388445583             NA
375    100   6.388445583             NA
376    100   9.861056861             NA
377    100   9.861056861             NA
378    100   9.861056861             NA
379    100   9.479675711             NA
380    100   9.479675711             NA
381    100   9.479675711             NA
382    100  10.654979640             NA
383    100  10.654979640             NA
384    100  10.654979640             NA
49       2  10.788697603   10.788697604
50       2  10.788697603   10.788697604
51       2  10.788697603   10.788697604
52       2   8.728189214    8.728189215
53       2   8.728189214    8.728189215
54       2   8.728189214    8.728189215
55       2  10.348507081   10.348507082
56       2  10.348507081   10.348507082
57       2  10.348507081   10.348507082
58       2  10.491889153   10.491889154
59       2  10.491889153   10.491889154
60       2  10.491889153   10.491889154
61       2   9.764878647    9.764878648
62       2   9.764878647    9.764878648
63       2   9.764878647    9.764878648
64       2  10.159568881   10.159568882
65       2  10.159568881   10.159568882
66       2  10.159568881   10.159568882
67       2   8.831372619    8.831372620
68       2   8.831372619    8.831372620
69       2   8.831372619    8.831372620
70       2   9.298569650    9.298569651
71       2   9.298569650    9.298569651
72       2   9.298569650    9.298569651
73       2   9.643529914    9.643529915
74       2   9.643529914    9.643529915
75       2   9.643529914    9.643529915
76       2  10.697735078   10.697735079
77       2  10.697735078   10.697735079
78       2  10.697735078   10.697735079
79       2   5.951768076    5.951768076
80       2   5.951768076    5.951768076
81       2   5.951768076    5.951768076
82       2  10.189950686   10.189950687
83       2  10.189950686   10.189950687
84       2  10.189950686   10.189950687
85       2   6.388445583    6.388445583
86       2   6.388445583    6.388445583
87       2   6.388445583    6.388445583
88       2   9.861056861    9.861056862
89       2   9.861056861    9.861056862
90       2   9.861056861    9.861056862
91       2   9.479675711    9.479675712
92       2   9.479675711    9.479675712
93       2   9.479675711    9.479675712
94       2  10.654979640   10.654979641
95       2  10.654979640   10.654979641
96       2  10.654979640   10.654979641
97       4  10.788697603   10.788697603
98       4  10.788697603   10.788697603
99       4  10.788697603   10.788697603
100      4   8.728189214    8.728189214
101      4   8.728189214    8.728189214
102      4   8.728189214    8.728189214
103      4  10.348507081   10.348507081
104      4  10.348507081   10.348507081
105      4  10.348507081   10.348507081
106      4  10.491889153   10.491889153
107      4  10.491889153   10.491889153
108      4  10.491889153   10.491889153
109      4   9.764878647    9.764878647
110      4   9.764878647    9.764878647
111      4   9.764878647    9.764878647
112      4  10.159568881   10.159568881
113      4  10.159568881   10.159568881
114      4  10.159568881   10.159568881
115      4   8.831372619    8.831372619
116      4   8.831372619    8.831372619
117      4   8.831372619    8.831372619
118      4   9.298569650    9.298569650
119      4   9.298569650    9.298569650
120      4   9.298569650    9.298569650
121      4   9.643529914    9.643529915
122      4   9.643529914    9.643529915
123      4   9.643529914    9.643529915
124      4  10.697735078   10.697735078
125      4  10.697735078   10.697735078
126      4  10.697735078   10.697735078
127      4   5.951768076    5.951768076
128      4   5.951768076    5.951768076
129      4   5.951768076    5.951768076
130      4  10.189950686   10.189950686
131      4  10.189950686   10.189950686
132      4  10.189950686   10.189950686
133      4   6.388445583    6.388445583
134      4   6.388445583    6.388445583
135      4   6.388445583    6.388445583
136      4   9.861056861    9.861056861
137      4   9.861056861    9.861056861
138      4   9.861056861    9.861056861
139      4   9.479675711    9.479675711
140      4   9.479675711    9.479675711
141      4   9.479675711    9.479675711
142      4  10.654979640   10.654979640
143      4  10.654979640   10.654979640
144      4  10.654979640   10.654979640
433    102  10.788697603             NA
434    102  10.788697603             NA
435    102  10.788697603             NA
436    102   8.728189214             NA
437    102   8.728189214             NA
438    102   8.728189214             NA
439    102  10.348507081             NA
440    102  10.348507081             NA
441    102  10.348507081             NA
442    102  10.491889153             NA
443    102  10.491889153             NA
444    102  10.491889153             NA
445    102   9.764878647             NA
446    102   9.764878647             NA
447    102   9.764878647             NA
448    102  10.159568881             NA
449    102  10.159568881             NA
450    102  10.159568881             NA
451    102   8.831372619             NA
452    102   8.831372619             NA
453    102   8.831372619             NA
454    102   9.298569650             NA
455    102   9.298569650             NA
456    102   9.298569650             NA
457    102   9.643529914             NA
458    102   9.643529914             NA
459    102   9.643529914             NA
460    102  10.697735078             NA
461    102  10.697735078             NA
462    102  10.697735078             NA
463    102   5.951768076             NA
464    102   5.951768076             NA
465    102   5.951768076             NA
466    102  10.189950686             NA
467    102  10.189950686             NA
468    102  10.189950686             NA
469    102   6.388445583             NA
470    102   6.388445583             NA
471    102   6.388445583             NA
472    102   9.861056861             NA
473    102   9.861056861             NA
474    102   9.861056861             NA
475    102   9.479675711             NA
476    102   9.479675711             NA
477    102   9.479675711             NA
478    102  10.654979640             NA
479    102  10.654979640             NA
480    102  10.654979640             NA
> (n2prD01 <- predict(fit2, newD, level=0:1))#  "
    TreeID predict.fixed predict.TreeID
1        1  10.691223184   10.691223185
2        1  10.296461851   10.296461853
3        1  11.075393500   11.075393502
4        1   8.585737592    8.585737593
5        1   8.270794578    8.270794579
6        1   9.031667478    9.031667479
7        1  10.238808357   10.238808359
8        1   9.861283701    9.861283702
9        1  10.641512295   10.641512296
10       1  10.386015159   10.386015160
11       1  10.002887181   10.002887183
12       1  10.783000682   10.783000684
13       1   9.641171768    9.641171769
14       1   9.286344671    9.286344672
15       1  10.063976116   10.063976117
16       1  10.045061415   10.045061416
17       1   9.674904021    9.674904022
18       1  10.454830699   10.454830701
19       1   8.690436645    8.690436646
20       1   8.371548550    8.371548551
21       1   9.134786357    9.134786358
22       1   9.165463081    9.165463082
23       1   8.828644301    8.828644302
24       1   9.600661596    9.600661597
25       1   9.517224052    9.517224053
26       1   9.167094092    9.167094093
27       1   9.943567233    9.943567234
28       1  10.597617261   10.597617263
29       1  10.206426097   10.206426099
30       1  10.985855161   10.985855162
31       1   5.797197250    5.797197251
32       1   5.586401047    5.586401048
33       1   6.225686453    6.225686454
34       1  10.076198761   10.076198762
35       1   9.704857944    9.704857945
36       1  10.484867975   10.484867976
37       1   6.232149537    6.232149538
38       1   6.005226196    6.005226197
39       1   6.671050826    6.671050827
40       1   9.739486438    9.739486439
41       1   9.380931091    9.380931092
42       1  10.159329341   10.159329343
43       1   9.350031285    9.350031286
44       1   9.006231698    9.006231699
45       1   9.780802934    9.780802935
46       1  10.553640476   10.553640477
47       1  10.164125911   10.164125912
48       1  10.943747492   10.943747494
193      7  10.691223184   10.691223183
194      7  10.296461851   10.296461851
195      7  11.075393500   11.075393500
196      7   8.585737592    8.585737591
197      7   8.270794578    8.270794577
198      7   9.031667478    9.031667478
199      7  10.238808357   10.238808357
200      7   9.861283701    9.861283700
201      7  10.641512295   10.641512295
202      7  10.386015159   10.386015158
203      7  10.002887181   10.002887181
204      7  10.783000682   10.783000682
205      7   9.641171768    9.641171767
206      7   9.286344671    9.286344671
207      7  10.063976116   10.063976116
208      7  10.045061415   10.045061415
209      7   9.674904021    9.674904021
210      7  10.454830699   10.454830699
211      7   8.690436645    8.690436644
212      7   8.371548550    8.371548549
213      7   9.134786357    9.134786357
214      7   9.165463081    9.165463080
215      7   8.828644301    8.828644301
216      7   9.600661596    9.600661595
217      7   9.517224052    9.517224051
218      7   9.167094092    9.167094091
219      7   9.943567233    9.943567232
220      7  10.597617261   10.597617261
221      7  10.206426097   10.206426097
222      7  10.985855161   10.985855160
223      7   5.797197250    5.797197250
224      7   5.586401047    5.586401047
225      7   6.225686453    6.225686453
226      7  10.076198761   10.076198760
227      7   9.704857944    9.704857944
228      7  10.484867975   10.484867974
229      7   6.232149537    6.232149537
230      7   6.005226196    6.005226196
231      7   6.671050826    6.671050825
232      7   9.739486438    9.739486437
233      7   9.380931091    9.380931091
234      7  10.159329341   10.159329341
235      7   9.350031285    9.350031285
236      7   9.006231698    9.006231698
237      7   9.780802934    9.780802933
238      7  10.553640476   10.553640475
239      7  10.164125911   10.164125910
240      7  10.943747492   10.943747492
289     12  10.691223184   10.691223184
290     12  10.296461851   10.296461852
291     12  11.075393500   11.075393501
292     12   8.585737592    8.585737592
293     12   8.270794578    8.270794578
294     12   9.031667478    9.031667478
295     12  10.238808357   10.238808358
296     12   9.861283701    9.861283701
297     12  10.641512295   10.641512295
298     12  10.386015159   10.386015159
299     12  10.002887181   10.002887182
300     12  10.783000682   10.783000683
301     12   9.641171768    9.641171768
302     12   9.286344671    9.286344671
303     12  10.063976116   10.063976116
304     12  10.045061415   10.045061415
305     12   9.674904021    9.674904021
306     12  10.454830699   10.454830700
307     12   8.690436645    8.690436645
308     12   8.371548550    8.371548550
309     12   9.134786357    9.134786357
310     12   9.165463081    9.165463081
311     12   8.828644301    8.828644302
312     12   9.600661596    9.600661596
313     12   9.517224052    9.517224052
314     12   9.167094092    9.167094092
315     12   9.943567233    9.943567233
316     12  10.597617261   10.597617262
317     12  10.206426097   10.206426098
318     12  10.985855161   10.985855161
319     12   5.797197250    5.797197250
320     12   5.586401047    5.586401047
321     12   6.225686453    6.225686453
322     12  10.076198761   10.076198761
323     12   9.704857944    9.704857944
324     12  10.484867975   10.484867975
325     12   6.232149537    6.232149537
326     12   6.005226196    6.005226197
327     12   6.671050826    6.671050826
328     12   9.739486438    9.739486438
329     12   9.380931091    9.380931091
330     12  10.159329341   10.159329342
331     12   9.350031285    9.350031285
332     12   9.006231698    9.006231698
333     12   9.780802934    9.780802934
334     12  10.553640476   10.553640476
335     12  10.164125911   10.164125911
336     12  10.943747492   10.943747493
145      5  10.691223184   10.691223184
146      5  10.296461851   10.296461852
147      5  11.075393500   11.075393501
148      5   8.585737592    8.585737592
149      5   8.270794578    8.270794578
150      5   9.031667478    9.031667479
151      5  10.238808357   10.238808358
152      5   9.861283701    9.861283701
153      5  10.641512295   10.641512296
154      5  10.386015159   10.386015159
155      5  10.002887181   10.002887182
156      5  10.783000682   10.783000683
157      5   9.641171768    9.641171768
158      5   9.286344671    9.286344672
159      5  10.063976116   10.063976117
160      5  10.045061415   10.045061416
161      5   9.674904021    9.674904022
162      5  10.454830699   10.454830700
163      5   8.690436645    8.690436645
164      5   8.371548550    8.371548550
165      5   9.134786357    9.134786357
166      5   9.165463081    9.165463081
167      5   8.828644301    8.828644302
168      5   9.600661596    9.600661596
169      5   9.517224052    9.517224052
170      5   9.167094092    9.167094092
171      5   9.943567233    9.943567233
172      5  10.597617261   10.597617262
173      5  10.206426097   10.206426098
174      5  10.985855161   10.985855161
175      5   5.797197250    5.797197250
176      5   5.586401047    5.586401047
177      5   6.225686453    6.225686453
178      5  10.076198761   10.076198761
179      5   9.704857944    9.704857945
180      5  10.484867975   10.484867975
181      5   6.232149537    6.232149537
182      5   6.005226196    6.005226197
183      5   6.671050826    6.671050826
184      5   9.739486438    9.739486438
185      5   9.380931091    9.380931092
186      5  10.159329341   10.159329342
187      5   9.350031285    9.350031286
188      5   9.006231698    9.006231699
189      5   9.780802934    9.780802934
190      5  10.553640476   10.553640476
191      5  10.164125911   10.164125911
192      5  10.943747492   10.943747493
385    101  10.691223184             NA
386    101  10.296461851             NA
387    101  11.075393500             NA
388    101   8.585737592             NA
389    101   8.270794578             NA
390    101   9.031667478             NA
391    101  10.238808357             NA
392    101   9.861283701             NA
393    101  10.641512295             NA
394    101  10.386015159             NA
395    101  10.002887181             NA
396    101  10.783000682             NA
397    101   9.641171768             NA
398    101   9.286344671             NA
399    101  10.063976116             NA
400    101  10.045061415             NA
401    101   9.674904021             NA
402    101  10.454830699             NA
403    101   8.690436645             NA
404    101   8.371548550             NA
405    101   9.134786357             NA
406    101   9.165463081             NA
407    101   8.828644301             NA
408    101   9.600661596             NA
409    101   9.517224052             NA
410    101   9.167094092             NA
411    101   9.943567233             NA
412    101  10.597617261             NA
413    101  10.206426097             NA
414    101  10.985855161             NA
415    101   5.797197250             NA
416    101   5.586401047             NA
417    101   6.225686453             NA
418    101  10.076198761             NA
419    101   9.704857944             NA
420    101  10.484867975             NA
421    101   6.232149537             NA
422    101   6.005226196             NA
423    101   6.671050826             NA
424    101   9.739486438             NA
425    101   9.380931091             NA
426    101  10.159329341             NA
427    101   9.350031285             NA
428    101   9.006231698             NA
429    101   9.780802934             NA
430    101  10.553640476             NA
431    101  10.164125911             NA
432    101  10.943747492             NA
241     11  10.691223184   10.691223184
242     11  10.296461851   10.296461851
243     11  11.075393500   11.075393500
244     11   8.585737592    8.585737591
245     11   8.270794578    8.270794578
246     11   9.031667478    9.031667478
247     11  10.238808357   10.238808357
248     11   9.861283701    9.861283701
249     11  10.641512295   10.641512295
250     11  10.386015159   10.386015159
251     11  10.002887181   10.002887181
252     11  10.783000682   10.783000682
253     11   9.641171768    9.641171768
254     11   9.286344671    9.286344671
255     11  10.063976116   10.063976116
256     11  10.045061415   10.045061415
257     11   9.674904021    9.674904021
258     11  10.454830699   10.454830699
259     11   8.690436645    8.690436645
260     11   8.371548550    8.371548550
261     11   9.134786357    9.134786357
262     11   9.165463081    9.165463081
263     11   8.828644301    8.828644301
264     11   9.600661596    9.600661596
265     11   9.517224052    9.517224052
266     11   9.167094092    9.167094092
267     11   9.943567233    9.943567233
268     11  10.597617261   10.597617261
269     11  10.206426097   10.206426097
270     11  10.985855161   10.985855160
271     11   5.797197250    5.797197250
272     11   5.586401047    5.586401047
273     11   6.225686453    6.225686453
274     11  10.076198761   10.076198761
275     11   9.704857944    9.704857944
276     11  10.484867975   10.484867975
277     11   6.232149537    6.232149537
278     11   6.005226196    6.005226196
279     11   6.671050826    6.671050826
280     11   9.739486438    9.739486438
281     11   9.380931091    9.380931091
282     11  10.159329341   10.159329341
283     11   9.350031285    9.350031285
284     11   9.006231698    9.006231698
285     11   9.780802934    9.780802934
286     11  10.553640476   10.553640476
287     11  10.164125911   10.164125911
288     11  10.943747492   10.943747492
337    100  10.691223184             NA
338    100  10.296461851             NA
339    100  11.075393500             NA
340    100   8.585737592             NA
341    100   8.270794578             NA
342    100   9.031667478             NA
343    100  10.238808357             NA
344    100   9.861283701             NA
345    100  10.641512295             NA
346    100  10.386015159             NA
347    100  10.002887181             NA
348    100  10.783000682             NA
349    100   9.641171768             NA
350    100   9.286344671             NA
351    100  10.063976116             NA
352    100  10.045061415             NA
353    100   9.674904021             NA
354    100  10.454830699             NA
355    100   8.690436645             NA
356    100   8.371548550             NA
357    100   9.134786357             NA
358    100   9.165463081             NA
359    100   8.828644301             NA
360    100   9.600661596             NA
361    100   9.517224052             NA
362    100   9.167094092             NA
363    100   9.943567233             NA
364    100  10.597617261             NA
365    100  10.206426097             NA
366    100  10.985855161             NA
367    100   5.797197250             NA
368    100   5.586401047             NA
369    100   6.225686453             NA
370    100  10.076198761             NA
371    100   9.704857944             NA
372    100  10.484867975             NA
373    100   6.232149537             NA
374    100   6.005226196             NA
375    100   6.671050826             NA
376    100   9.739486438             NA
377    100   9.380931091             NA
378    100  10.159329341             NA
379    100   9.350031285             NA
380    100   9.006231698             NA
381    100   9.780802934             NA
382    100  10.553640476             NA
383    100  10.164125911             NA
384    100  10.943747492             NA
49       2  10.691223184   10.691223185
50       2  10.296461851   10.296461852
51       2  11.075393500   11.075393502
52       2   8.585737592    8.585737592
53       2   8.270794578    8.270794579
54       2   9.031667478    9.031667479
55       2  10.238808357   10.238808359
56       2   9.861283701    9.861283702
57       2  10.641512295   10.641512296
58       2  10.386015159   10.386015160
59       2  10.002887181   10.002887183
60       2  10.783000682   10.783000684
61       2   9.641171768    9.641171769
62       2   9.286344671    9.286344672
63       2  10.063976116   10.063976117
64       2  10.045061415   10.045061416
65       2   9.674904021    9.674904022
66       2  10.454830699   10.454830700
67       2   8.690436645    8.690436646
68       2   8.371548550    8.371548551
69       2   9.134786357    9.134786358
70       2   9.165463081    9.165463082
71       2   8.828644301    8.828644302
72       2   9.600661596    9.600661597
73       2   9.517224052    9.517224053
74       2   9.167094092    9.167094093
75       2   9.943567233    9.943567234
76       2  10.597617261   10.597617262
77       2  10.206426097   10.206426098
78       2  10.985855161   10.985855162
79       2   5.797197250    5.797197250
80       2   5.586401047    5.586401048
81       2   6.225686453    6.225686454
82       2  10.076198761   10.076198762
83       2   9.704857944    9.704857945
84       2  10.484867975   10.484867976
85       2   6.232149537    6.232149538
86       2   6.005226196    6.005226197
87       2   6.671050826    6.671050826
88       2   9.739486438    9.739486439
89       2   9.380931091    9.380931092
90       2  10.159329341   10.159329343
91       2   9.350031285    9.350031286
92       2   9.006231698    9.006231699
93       2   9.780802934    9.780802935
94       2  10.553640476   10.553640477
95       2  10.164125911   10.164125912
96       2  10.943747492   10.943747494
97       4  10.691223184   10.691223184
98       4  10.296461851   10.296461852
99       4  11.075393500   11.075393501
100      4   8.585737592    8.585737592
101      4   8.270794578    8.270794578
102      4   9.031667478    9.031667478
103      4  10.238808357   10.238808358
104      4   9.861283701    9.861283701
105      4  10.641512295   10.641512295
106      4  10.386015159   10.386015159
107      4  10.002887181   10.002887182
108      4  10.783000682   10.783000683
109      4   9.641171768    9.641171768
110      4   9.286344671    9.286344671
111      4  10.063976116   10.063976116
112      4  10.045061415   10.045061415
113      4   9.674904021    9.674904021
114      4  10.454830699   10.454830700
115      4   8.690436645    8.690436645
116      4   8.371548550    8.371548550
117      4   9.134786357    9.134786357
118      4   9.165463081    9.165463081
119      4   8.828644301    8.828644302
120      4   9.600661596    9.600661596
121      4   9.517224052    9.517224052
122      4   9.167094092    9.167094092
123      4   9.943567233    9.943567233
124      4  10.597617261   10.597617262
125      4  10.206426097   10.206426098
126      4  10.985855161   10.985855161
127      4   5.797197250    5.797197250
128      4   5.586401047    5.586401047
129      4   6.225686453    6.225686453
130      4  10.076198761   10.076198761
131      4   9.704857944    9.704857944
132      4  10.484867975   10.484867975
133      4   6.232149537    6.232149537
134      4   6.005226196    6.005226197
135      4   6.671050826    6.671050826
136      4   9.739486438    9.739486438
137      4   9.380931091    9.380931091
138      4  10.159329341   10.159329342
139      4   9.350031285    9.350031285
140      4   9.006231698    9.006231698
141      4   9.780802934    9.780802934
142      4  10.553640476   10.553640476
143      4  10.164125911   10.164125911
144      4  10.943747492   10.943747493
433    102  10.691223184             NA
434    102  10.296461851             NA
435    102  11.075393500             NA
436    102   8.585737592             NA
437    102   8.270794578             NA
438    102   9.031667478             NA
439    102  10.238808357             NA
440    102   9.861283701             NA
441    102  10.641512295             NA
442    102  10.386015159             NA
443    102  10.002887181             NA
444    102  10.783000682             NA
445    102   9.641171768             NA
446    102   9.286344671             NA
447    102  10.063976116             NA
448    102  10.045061415             NA
449    102   9.674904021             NA
450    102  10.454830699             NA
451    102   8.690436645             NA
452    102   8.371548550             NA
453    102   9.134786357             NA
454    102   9.165463081             NA
455    102   8.828644301             NA
456    102   9.600661596             NA
457    102   9.517224052             NA
458    102   9.167094092             NA
459    102   9.943567233             NA
460    102  10.597617261             NA
461    102  10.206426097             NA
462    102  10.985855161             NA
463    102   5.797197250             NA
464    102   5.586401047             NA
465    102   6.225686453             NA
466    102  10.076198761             NA
467    102   9.704857944             NA
468    102  10.484867975             NA
469    102   6.232149537             NA
470    102   6.005226196             NA
471    102   6.671050826             NA
472    102   9.739486438             NA
473    102   9.380931091             NA
474    102  10.159329341             NA
475    102   9.350031285             NA
476    102   9.006231698             NA
477    102   9.780802934             NA
478    102  10.553640476             NA
479    102  10.164125911             NA
480    102  10.943747492             NA
> ## consistency :
> stopifnot(
+     identical(is.na(n1prD1), is.na(n2prD1)),
+     identical(sort(unique(newD[is.na(n2prD1), "TreeID"])), 100:102),
+     sort(unique( newD[is.na(n2prD1), "TreeID"] )) %in% 100:102 ,
+     all.equal(as.vector(n1prD0), n1prD01[,"predict.fixed"], tolerance= 1e-15),
+     all.equal(as.vector(n2prD0), n2prD01[,"predict.fixed"], tolerance= 1e-15),
+     all.equal(as.vector(n1prD1), n1prD01[,"predict.TreeID"],tolerance= 1e-15),
+     all.equal(as.vector(n2prD1), n2prD01[,"predict.TreeID"],tolerance= 1e-15))
> 
> proc.time()
   user  system elapsed 
  0.504   0.024   0.526 
